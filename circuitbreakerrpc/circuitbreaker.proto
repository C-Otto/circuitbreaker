syntax = "proto3";

package circuitbreaker;

option go_package = "github.com/lightningequipment/circuitbreaker/circuitbreakerrpc";

service Service {
    rpc GetInfo (GetInfoRequest) returns (GetInfoResponse);

    rpc UpdateLimit (UpdateLimitRequest) returns (UpdateLimitResponse);

    rpc ClearLimit (ClearLimitRequest) returns (ClearLimitResponse);

    rpc UpdateDefaultLimit (UpdateDefaultLimitRequest) returns (UpdateDefaultLimitResponse);

    rpc ListLimits (ListLimitsRequest) returns (ListLimitsResponse);
}

message GetInfoRequest {}

message GetInfoResponse {
    string connected_node = 1;
}


message ClearLimitRequest {
    string node = 1;
}

message ClearLimitResponse {}

message UpdateLimitRequest {
    string node = 1;
    int64 max_hourly_rate = 2;
	int64 max_pending = 4;
}

message UpdateLimitResponse {}


message UpdateDefaultLimitRequest {
    int64 max_hourly_rate = 2;
	int64 max_pending = 4;
}

message UpdateDefaultLimitResponse {}

message ListLimitsRequest {}

message ListLimitsResponse {
    repeated int64 counter_intervals_sec = 1;

    Limit global_limit = 2;

    repeated NodeLimit limits = 3;
}

message NodeLimit {
    string node = 1;

    Limit limit = 3;

    repeated Counter counters = 6;
}

message Limit {
    int64 max_hourly_rate = 3;
	int64 max_pending = 5;
}

message Counter {
    int64 fail = 1;
    int64 success = 2;
    int64 reject = 3;
}